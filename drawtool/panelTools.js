({710:function(){var t,e;window.TextCursor||(window.TextCursor=function(t,e){this.fillStyle=t||"rgba(0, 0, 0, 0.7)",this.width=e||2,this.left=0,this.top=0},window.TextCursor.prototype={getHeight:function(t){t=t.measureText("W").width;return t+t/6},createPath:function(t){t.beginPath(),t.rect(this.left,this.top,this.width,this.getHeight(t))},draw:function(t,e,i){t.save(),this.left=e,this.top=i-this.getHeight(t),this.createPath(t),t.lineWidth=1,t.fillStyle=this.fillStyle,t.fill(),t.restore()},erase:function(t){window.NOTEPAD.restoreCanvas([this.left-1,this.top,this.width+2,this.getHeight(t)])}}),window.TextLine||(window.TextLine=function(t,e){this.text="",this.left=t,this.bottom=e,this.caret=0},window.TextLine.prototype={insert:function(t){var e=this.text.slice(0,this.caret),i=this.text.slice(this.caret);this.text=e+=t,this.text+=i,this.caret+=t.length},getCaretX:function(t){var e=this.text.substring(0,this.caret),t=t.measureText(e).width;return this.left+t},removeCharacterBeforeCaret:function(){0!==this.caret&&(this.text=this.text.substring(0,this.caret-1)+this.text.substring(this.caret),this.caret--)},removeLastCharacter:function(){this.text=this.text.slice(0,-1)},getWidth:function(t){return t.measureText(this.text).width},getHeight:function(t){t=t.measureText("W").width;return t+t/6},draw:function(t){t.save(),t.textAlign="start",t.textBaseline="bottom",t.lineWidth=1,t.strokeText(this.text,this.left,this.bottom),t.fillText(this.text,this.left,this.bottom),t.restore()},erase:function(t){window.NOTEPAD.restoreCanvas()}}),window.Paragraph||(window.Paragraph=function(t,e,i,n,s){this.context=t,this.drawingSurface=n,this.left=e,this.top=i,this.lines=[],this.activeLine=void 0,this.cursor=s,this.blinkingInterval=void 0},window.Paragraph.prototype={clearIntervals:function(t){this.blinkingInterval=window.clearInterval(this.blinkingInterval),this.blinkingTimeout=window.clearTimeout(this.blinkingTimeout),this.cursor.erase(this.context,this.drawingSurface),"function"!=typeof t||this.blinkingInterval?this.blinkingInterval&&this.clearIntervals(t):t()},isPointInside:function(t){var e=this.context;return e.beginPath(),e.rect(this.left,this.top,this.getWidth(),this.getHeight()),e.isPointInPath(t.x,t.y)},getHeight:function(){var e=0;return this.lines.forEach(Function.prototype.bind.call(function(t){e+=t.getHeight(this.context)},this)),e},getWidth:function(){var e,i=0;return this.lines.forEach(Function.prototype.bind.call(function(t){e=t.getWidth(this.context),i<e&&(i=e)},this)),i},draw:function(){this.lines.forEach(Function.prototype.bind.call(function(t){t.draw(this.context)},this))},erase:function(t){window.NOTEPAD.restoreCanvas()},addLine:function(t){this.lines.push(t),this.activeLine=t,this.moveCursor(t.left,t.bottom)},insert:function(t){this.erase(this.context,this.drawingSurface),this.activeLine.insert(t);t=this.activeLine.text.substring(0,this.activeLine.caret),t=this.context.measureText(t).width;this.moveCursor(this.activeLine.left+t,this.activeLine.bottom),this.draw(this.context)},blinkCursor:function(t,e){var i=this;this.blinkingInterval&&(this.blinkingInterval=window.clearInterval(this.blinkingInterval)),this.blinkingInterval=setInterval(function(t){var e=window.NOTEPAD.drawOptions[window.NOTEPAD.selectedDrawOption];e&&"text"===e.type?(i.cursor.erase(i.context,i.drawingSurface),i.blinkingTimeout&&(i.blinkingTimeout=window.clearTimeout(i.blinkingTimeout)),i.blinkingTimeout=setTimeout(function(t){i.cursor.draw(i.context,i.cursor.left,i.cursor.top+i.cursor.getHeight(i.context))},200)):i.blinkingInterval=window.clearInterval(i.blinkingInterval)},900)},moveCursorCloseTo:function(t,e){e=this.getLine(e);e&&(e.caret=this.getColumn(e,t),this.activeLine=e,this.moveCursor(e.getCaretX(this.context),e.bottom))},moveCursor:function(t,e){this.cursor.erase(this.context,this.drawingSurface),this.cursor.draw(this.context,t,e),this.blinkingInterval||this.blinkCursor(t,e)},moveLinesDown:function(t){for(var e=t;e<this.lines.length;++e){var i=this.lines[e];i.bottom+=i.getHeight(this.context)}},newline:function(){var t,e=this.activeLine.text.substring(0,this.activeLine.caret),i=this.activeLine.text.substring(this.activeLine.caret),n=this.context.measureText("W").width+this.context.measureText("W").width/6,s=this.activeLine.bottom+n;this.erase(this.context,this.drawingSurface),this.activeLine.text=e,(t=new TextLine(this.activeLine.left,s)).insert(i),e=this.lines.indexOf(this.activeLine),this.lines.splice(e+1,0,t),this.activeLine=t,this.activeLine.caret=0;for(var o=this.lines.indexOf(this.activeLine)+1;o<this.lines.length;++o)(t=this.lines[o]).bottom+=n;this.draw(),this.cursor.draw(this.context,this.activeLine.left,this.activeLine.bottom)},getLine:function(t){for(var e,i=0;i<this.lines.length;++i)if(t>(e=this.lines[i]).bottom-e.getHeight(this.context)&&t<e.bottom)return e},getColumn:function(t,e){var i,n,s,o,a=!1;for((s=new TextLine(t.left,t.bottom)).insert(t.text);!a&&0<s.text.length;)i=s.left+s.getWidth(this.context),s.removeLastCharacter(),(n=s.left+s.getWidth(this.context))<e&&(o=(e-n<i-e?n:i)===i?s.text.length+1:s.text.length,a=!0);return o},activeLineIsOutOfText:function(){return 0===this.activeLine.text.length},activeLineIsTopLine:function(){return this.lines[0]===this.activeLine},moveUpOneLine:function(){var t,e=""+this.activeLine.text,i=this.lines.indexOf(this.activeLine);this.activeLine=this.lines[i-1],this.activeLine.caret=this.activeLine.text.length,this.lines.splice(i,1),this.moveCursor(this.activeLine.left+this.activeLine.getWidth(this.context),this.activeLine.bottom),this.activeLine.text+=e;for(var n=i;n<this.lines.length;++n)(t=this.lines[n]).bottom-=t.getHeight(this.context)},backspace:function(){var t;this.context.save(),0===this.activeLine.caret?this.activeLineIsTopLine()||(this.erase(this.context,this.drawingSurface),this.moveUpOneLine(),this.draw()):(this.erase(this.context,this.drawingSurface),this.activeLine.removeCharacterBeforeCaret(),t=this.activeLine.text.slice(0,this.activeLine.caret),t=this.context.measureText(t).width,this.moveCursor(this.activeLine.left+t,this.activeLine.bottom),this.draw(this.context),this.context.restore())}}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");function e(){return n.apply(this instanceof s&&t?this:t,i.concat(Array.prototype.slice.call(arguments)))}var i=Array.prototype.slice.call(arguments,1),n=this,s=function(){};return s.prototype=this.prototype,e.prototype=new s,e}),t=void 0!==window?window:this,e=function(l){function t(){this.MAX_ITEMS=50,this.currentIndex=0,this.array=[]}t.prototype.add=function(t){this.currentIndex<this.array.length-1?(this.array[++this.currentIndex]=t,this.array=this.array.slice(0,this.currentIndex+1)):(this.array.push(t),this.currentIndex=this.array.length-1),this.array.length>this.MAX_ITEMS&&(t=this.array.length-this.MAX_ITEMS,this.array=this.array.splice(-this.MAX_ITEMS),this.currentIndex=this.currentIndex-t)},t.prototype.previous=function(){return 0===this.currentIndex?null:this.array[--this.currentIndex]},t.prototype.next=function(){return this.currentIndex===this.array.length-1?null:this.array[++this.currentIndex]},t.prototype.hasPrevious=function(){return 0<this.currentIndex},t.prototype.hasNext=function(){return this.currentIndex<this.array.length-1};var d="undefined"!=typeof chrome?chrome:"undefined"!=typeof browser?browser:void 0,e={canvas:null,context:null,buffer:null,initialized:!1,controlPanelHidden:!1,persistTimer:null,history:null,config:{},drawOptions:[{type:"cursor",title:"Cursor - Sử dụng chuột"},{type:"pen",title:"Pencil - vẽ tự do"},{type:"eraser",title:"Eraser - xóa hình vẽ",width:30,height:30},{type:"fill",title:"Paint Bucket - tô màu"},{type:"eyedropper",title:"Color picker - lấy mã màu từ web"},{type:"text",font:"Arial",minSize:15,maxSize:50,title:"Text - chèn chữ"},{type:"rectangle",title:"Rectangle - vẽ hình vuông hoặc chữ nhật"},{type:"circle",title:"Ellipse - vẽ hình elip hoặc tròn"},{type:"line",title:"Line - vẽ đường thẳng"},{type:"quadratic_curve",title:"Quadratic curve - vẽ đường cong",iteration:0,initLoc:null,lastLoc:null},{type:"bezier_curve",title:"Bezier curve - vẽ đường cong uốn lượn",iteration:0,initLoc:null,firstPoint:null,lastPoint:null},{type:"polygon",title:"Polygon - vẽ hình đa cạnh",initLoc:null,lastLoc:null}],selectedDrawOption:null,selectedColorOption:null,selectedAlphaOption:null,mousedown:!1,lastMouseDownLoc:null,drawingSurfaceImageData:null,resizeTimeoutID:null,cursor:new TextCursor,paragraph:null,panel:null,browser:{isChrome:/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},createCanvas:function(){this.canvas=l.document.createElement("canvas"),this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this.canvas.setAttribute("id","NOTEPAD"),this.browser.isChrome||(this.buffer=document.createElement("canvas")),l.document.body.appendChild(this.canvas),l.addEventListener("resize",this.resizeBinded),l.addEventListener("scroll",this.resizeBinded);var t,e=localStorage.getItem("WP_CRX_STORAGE_SNAPSHOT_"+l.location.pathname);e?((t=new Image).onload=Function.prototype.bind.call(this.initCanvas,this,t),t.src=e):this.initCanvas()},initCanvas:function(t){t?(this.handleResize(!0),this.context.drawImage(t,0,0),this.storeCanvas(!0)):this.handleResize(),this.storeHistory()},checkHistoryButtonStatus:function(){this.nextBtn&&this.backBtn&&(this.history.hasNext()?this.removeClass(this.nextBtn,"disabled"):this.addClass(this.nextBtn,"disabled"),this.history.hasPrevious()?this.removeClass(this.backBtn,"disabled"):this.addClass(this.backBtn,"disabled"))},storeHistory:function(){this.history.add(this.context.getImageData(0,0,this.canvas.width,this.canvas.height,{willReadFrequently:!0})),this.checkHistoryButtonStatus()},handleBackButtonClick:function(){this.history.hasPrevious()&&(this.finishLastDrawing(),this.context.putImageData(this.history.previous(),0,0),this.storeCanvas(),this.checkHistoryButtonStatus())},handleForwardButtonClick:function(){this.history.hasNext()&&(this.finishLastDrawing(),this.context.putImageData(this.history.next(),0,0),this.storeCanvas(),this.checkHistoryButtonStatus())},persistLocalStorage:function(){var e=this.canvas.toDataURL();try{l.localStorage.setItem("WP_CRX_STORAGE_SNAPSHOT_"+l.location.pathname,e)}catch(t){try{l.localStorage.clear(),l.localStorage.setItem("WP_CRX_STORAGE_SNAPSHOT_"+l.location.pathname,e)}catch(t){}}},storeCanvas:function(t){this.browser.isChrome?this.buffer=this.context.getImageData(0,0,this.canvas.width,this.canvas.height):(this.buffer.width=this.canvas.width,this.buffer.height=this.canvas.height,this.buffer.getContext("2d",{willReadFrequently:!0}).drawImage(this.canvas,0,0)),t||(this.persistTimer&&(this.persistTimer=l.clearInterval(this.persistTimer)),this.persistTimer=l.setTimeout(this.persistLocalStorageBinded,500))},restoreCanvas:function(t){t?(this.context.clearRect.apply(this.context,t),(this.browser.isChrome?(t.unshift(this.buffer,0,0),this.context.putImageData):(t.unshift(this.buffer),this.context.drawImage)).apply(this.context,t)):(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.browser.isChrome?this.context.putImageData(this.buffer,0,0):this.context.drawImage(this.buffer,0,0))},handlePanelAppearing:function(t){t.target.style.opacity=1},handleResize:function(t){var e=!1,i=l.pageYOffset||document.documentElement.scrollTop,n=(l.innerHeight||document.documentElement.clientHeight,this.context.lineWidth),s=Math.max(document.documentElement.clientWidth,document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth),o=Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight),a=Math.min(o-this.canvas.offsetTop,5e3);5e3<i-this.canvas.offsetTop?(a=Math.min(o-i,5e3),this.canvas.style.top=i+"px",e=!0):i<this.canvas.offsetTop&&(a=5e3,this.canvas.style.top=Math.max(0,5e3*Math.floor(i/5e3))+"px",e=!0),e?(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.paragraph&&(this.paragraph.clearIntervals(),this.paragraph=null),this.storeCanvas(!0)):this.storeCanvas(t),this.canvas.width=s,this.canvas.height=a,e||this.restoreCanvas(),this.updatePaintStyle(),this.context.lineWidth=n},createControlPanel:function(){this.panel=l.document.createElement("div"),this.backBtn=l.document.createElement("div"),this.nextBtn=l.document.createElement("div");var t=l.document.createElement("div"),e=l.document.createElement("div"),i=l.document.createElement("div"),n=l.document.createElement("div"),s=l.document.createElement("div");color=l.document.createElement("div"),this.panel.setAttribute("id","NOTEPAD_controls"),t.setAttribute("class","NOTEPAD_controls_draw"),e.setAttribute("class","NOTEPAD_controls_color"),i.setAttribute("class","NOTEPAD_controls_control"),n.setAttribute("class","NOTEPAD_controls_range alpha_control"),s.setAttribute("class","NOTEPAD_controls_range size_control"),color.setAttribute("class","contener_color"),l.document.body.appendChild(this.panel),this.panel.appendChild(t),this.panel.appendChild(e),this.panel.appendChild(n),this.panel.appendChild(s),this.panel.appendChild(i);for(var o=0;o<this.drawOptions.length;o++){var a=this.drawOptions[o],r=l.document.createElement("div");r.setAttribute("class","NOTEPAD_controls_draw_option"),r.setAttribute("title",a.title),this.addClass(r,a.type),r.addEventListener("click",Function.prototype.bind.call(this.onControlPanelClick,this,o)),t.appendChild(r),(null!==this.config.tool&&void 0!==this.config.tool||0!==o)&&o!==this.config.tool||this.triggerClick(r)}this.colorPicker=l.document.createElement("input"),this.colorPicker.setAttribute("type","color"),this.colorPicker.setAttribute("id","controls_color"),this.colorPicker.value=this.config.color||"#000000",this.colorPicker.setAttribute("title","Chọn một màu"),this.colorPicker.addEventListener("change",Function.prototype.bind.call(this.onColorPanelClick,this),!1),e.appendChild(color),color.appendChild(this.colorPicker),this.alphaPicker=l.document.createElement("input"),this.alphaPicker.setAttribute("type","range"),this.alphaPicker.setAttribute("min","0"),this.alphaPicker.setAttribute("max","1"),this.alphaPicker.setAttribute("step","0.01"),this.alphaPicker.value=null!==this.config.alpha&&void 0!==this.config.alpha?this.config.alpha:1,this.alphaPicker.setAttribute("title","Độ trong suốt"),this.alphaPicker.addEventListener("change",Function.prototype.bind.call(this.onAlphaChange,this),!1),this.alphaPicker.addEventListener("input",Function.prototype.bind.call(this.onAlphaUpdate,this),!1),this.alphaPickerPreview=l.document.createElement("span");var e=l.document.createElement("span"),e=(this.alphaPickerPreview.setAttribute("class","NOTEPAD_controls_range_percent"),e.setAttribute("class","NOTEPAD_controls_range_alpha_control"),e.textContent="Transp.",n.appendChild(this.alphaPicker),n.appendChild(e),n.appendChild(this.alphaPickerPreview),l.document.createElement("input")),n=(e.setAttribute("type","range"),e.setAttribute("min","1"),e.setAttribute("max","20"),e.setAttribute("step","1"),e.value=this.config.thickness||1,e.setAttribute("title","Kích thước đường kẻ"),e.addEventListener("change",Function.prototype.bind.call(this.onLineChange,this),!1),e.addEventListener("input",Function.prototype.bind.call(this.onLineUpdate,this),!1),this.linePickerPreview=l.document.createElement("span"),l.document.createElement("span")),n=(this.linePickerPreview.setAttribute("class","NOTEPAD_controls_range_size_control_percent"),n.setAttribute("class","NOTEPAD_controls_range_size_control"),n.textContent="Size",s.appendChild(e),s.appendChild(n),s.appendChild(this.linePickerPreview),this.selectedColorOption=this.hexToRgb(this.colorPicker.value),this.selectedAlphaOption=this.alphaPicker.value,this.context.lineWidth=e.value,this.alphaPickerPreview.innerHTML=Math.round(100*this.selectedAlphaOption)+"%",this.linePickerPreview.innerHTML=Math.round(this.context.lineWidth/20*100)+"%",this.updatePaintStyle(),l.document.createElement("div")),s=l.document.createElement("div"),e=l.document.createElement("div"),h=l.document.createElement("div"),c=l.document.createElement("div");s.setAttribute("class","NOTEPAD_controls_control_option exitBtn"),s.setAttribute("title","Thoát (ESC)"),this.backBtn.setAttribute("class","NOTEPAD_controls_control_option backBtn"),this.backBtn.setAttribute("title","Quay ngược"),this.nextBtn.setAttribute("class","NOTEPAD_controls_control_option nextBtn"),this.nextBtn.setAttribute("title","Quay xuôi"),e.setAttribute("class","NOTEPAD_controls_control_option eraseAllBtn"),e.setAttribute("title","Xóa hết (Delete)"),h.setAttribute("class","NOTEPAD_controls_control_option hideCtrlBtn"),h.setAttribute("title","Đóng bảng điều kiển (Vẫn dùng công cụ vẽ)"),n.addEventListener("click",Function.prototype.bind.call(this.onPrintButtonClick,this)),s.addEventListener("click",Function.prototype.bind.call(this.exit,this)),this.backBtn.addEventListener("click",Function.prototype.bind.call(this.handleBackButtonClick,this)),this.nextBtn.addEventListener("click",Function.prototype.bind.call(this.handleForwardButtonClick,this)),e.addEventListener("click",Function.prototype.bind.call(this.eraseAll,this)),h.addEventListener("click",Function.prototype.bind.call(this.hideControlPanel,this)),c.addEventListener("click",function(){d.runtime.sendMessage({method:"open_options"})}),i.appendChild(this.backBtn),i.appendChild(this.nextBtn),i.appendChild(e),i.appendChild(n),i.appendChild(h),i.appendChild(s),i.appendChild(c),this.checkHistoryButtonStatus(),this.CSSAnimationManager.supported?this.panel.addEventListener(this.CSSAnimationManager.end,Function.prototype.bind.call(this.handlePanelAppearing,this),!1):this.panel.style.opacity=1},finishLastDrawing:function(){var t=this.drawOptions[this.selectedDrawOption];t&&"polygon"===t.type&&t.lastLoc&&t.initLoc?(this.context.beginPath(),this.context.moveTo(t.lastLoc.x,t.lastLoc.y),this.context.lineTo(t.initLoc.x,t.initLoc.y),this.context.stroke(),this.context.closePath(),this.mousedown=!1,t.initLoc=null,t.lastLoc=null,this.storeCanvas(),this.storeHistory()):t&&"quadratic_curve"===t.type&&0!==t.iteration?(this.context.closePath(),this.storeCanvas(),this.storeHistory(),this.mousedown=!1,t.iteration=0,t.initLoc=null,t.lastLoc=null):t&&"bezier_curve"===t.type&&0!==t.iteration?(this.context.closePath(),this.storeCanvas(),this.storeHistory(),this.mousedown=!1,t.iteration=0,t.initLoc=null,t.firstPoint=null,t.lastPoint=null):"eyedropper"!==t&&!0===this.mousedown&&(this.mousedown=!1,this.storeCanvas(),this.storeHistory()),this.paragraph&&this.paragraph.clearIntervals(Function.prototype.bind.call(function(){this.paragraph=null,this.storeCanvas(),this.storeHistory()},this))},setColor:function(t){t&&(this.colorPicker.value=this.rgbToHex(t.r,t.g,t.b),this.selectedColorOption={r:t.r,g:t.g,b:t.b},this.alphaPicker.value=t.a/255,this.selectedAlphaOption=this.alphaPicker.value,this.alphaPickerPreview&&(this.alphaPickerPreview.innerHTML=Math.round(100*this.selectedAlphaOption)+"%"),this.updatePaintStyle(),this.config.color===this.colorPicker.value&&this.config.alpha===this.selectedAlphaOption||(this.config.color=this.colorPicker.value,this.config.alpha=this.selectedAlphaOption,this.saveData()))},getColorOfCurrentPixel:function({x:o,y:a}){const r=this;d.runtime.sendMessage({method:"get_pixel_color"},t=>{var i=document.createElement("canvas"),n=i.getContext("2d"),s=new Image;document.documentElement.appendChild(i),s.src=t,s.onload=function(){i.width=s.naturalWidth,i.height=s.naturalHeight,n.drawImage(s,0,0);var t=n.getImageData(0,0,i.width,i.height),e=4*(a*t.width+o),t=t.data,t={r:t[e],g:t[1+e],b:t[2+e],a:t[3+e]};document.documentElement.removeChild(i),r.setColorBinded(t)}})},onPrintButtonClick:function(){this.addClass(this.panel,"hide"),l.setTimeout(function(){d.runtime.sendMessage({method:"take_screen_shot"})},100),l.setTimeout(Function.prototype.bind.call(function(){this.removeClass(this.panel,"hide")},this),500)},onControlPanelClick:function(t,e){if(this.selectedDrawOption!==t){var i=l.document.querySelectorAll("#NOTEPAD_controls .NOTEPAD_controls_draw_option");this.finishLastDrawing();for(var n=0;n<i.length;n++)this.removeClass(i[n],"selected");this.addClass(i[t],"selected"),this.removeClass(this.canvas,"pen"),this.removeClass(this.canvas,"cross"),this.removeClass(this.canvas,"eraser"),this.removeClass(this.canvas,"text"),this.removeClass(this.canvas,"cursor"),this.removeClass(this.canvas,"eyedropper"),this.removeClass(this.canvas,"fill"),this.selectedDrawOption=t;t=this.drawOptions[this.selectedDrawOption];"pen"===t.type?this.addClass(this.canvas,"pen"):"eraser"===t.type?this.addClass(this.canvas,"eraser"):"text"===t.type?this.addClass(this.canvas,"text"):"cursor"===t.type?this.addClass(this.canvas,"cursor"):"eyedropper"===t.type?this.addClass(this.canvas,"eyedropper"):"fill"===t.type?this.addClass(this.canvas,"fill"):this.addClass(this.canvas,"cross"),this.config.tool!==this.selectedDrawOption&&(this.config.tool=this.selectedDrawOption,this.saveData()),"eyedropper"===t.type&&(new window.EyeDropper).open().then(t=>{this.setColor(this.hexToRgb(t.sRGBHex)),this.onControlPanelClick(9)})}},hexToRgb:function(t){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},rgbToHex:function(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},onColorPanelClick:function(t){this.selectedColorOption=this.hexToRgb(t.currentTarget.value),this.updatePaintStyle(),this.config.color!==t.currentTarget.value&&(this.config.color=t.currentTarget.value,this.saveData())},onAlphaChange:function(t){this.selectedAlphaOption=t.currentTarget.value,this.alphaPickerPreview&&(this.alphaPickerPreview.innerHTML=Math.round(100*this.selectedAlphaOption)+"%"),this.updatePaintStyle(),this.config.alpha!==this.selectedAlphaOption&&(this.config.alpha=this.selectedAlphaOption,this.saveData())},onAlphaUpdate:function(t){this.alphaPickerPreview&&(this.alphaPickerPreview.innerHTML=Math.round(100*t.currentTarget.value)+"%")},onLineChange:function(t){this.context.lineWidth=t.currentTarget.value,this.linePickerPreview&&(this.linePickerPreview.innerHTML=Math.round(this.context.lineWidth/20*100)+"%"),this.config.thickness!==this.context.lineWidth&&(this.config.thickness=this.context.lineWidth,this.saveData())},onLineUpdate:function(t){this.linePickerPreview&&(this.linePickerPreview.innerHTML=Math.round(t.currentTarget.value/20*100)+"%")},updatePaintStyle:function(){null!==this.selectedColorOption&&null!==this.selectedAlphaOption&&(this.cursor.fillStyle="rgba("+this.selectedColorOption.r+","+this.selectedColorOption.g+","+this.selectedColorOption.b+","+this.selectedAlphaOption+")",this.context.strokeStyle="rgba("+this.selectedColorOption.r+","+this.selectedColorOption.g+","+this.selectedColorOption.b+","+this.selectedAlphaOption+")",this.context.fillStyle="rgba("+this.selectedColorOption.r+","+this.selectedColorOption.g+","+this.selectedColorOption.b+","+this.selectedAlphaOption+")")},addMouseEventListener:function(){var t=Function.prototype.bind.call(this.handleMouseDown,this),e=Function.prototype.bind.call(this.handleMouseMove,this),i=Function.prototype.bind.call(this.handleMouseUp,this),n=Function.prototype.bind.call(this.handleMouseLeave,this);this.canvas.addEventListener("mousedown",t),this.canvas.addEventListener("touchstart",t),this.canvas.addEventListener("mousemove",e),this.canvas.addEventListener("touchmove",e),this.canvas.addEventListener("mouseup",i),this.canvas.addEventListener("touchend",i),this.canvas.addEventListener("mouseleave",n),l.document.addEventListener("keydown",this.keydownBinded),l.document.addEventListener("keypress",this.keypressBinded)},addKeyEventListeners:function(){this.config.hotkeys&&l.document.addEventListener("keydown",this.handleHotKeysDownBinded)},handleHotKeysDown:function(t){var e=l.event?event:t;if(e.ctrlKey&&e.shiftKey)for(var i in this.config.hotkeys)if(this.config.hotkeys.hasOwnProperty(i)&&this.config.hotkeys[i].charCodeAt(0)===e.keyCode){for(var n=0;n<this.drawOptions.length;n++)if(this.drawOptions[n].type===i){this.onControlPanelClick(n);break}break}},matchOutlineColor:function(t,e,i,n){return 255!==t&&255!==e&&255!==i&&0!==n},handleFill:function(t){var e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),i=4*(t.y*this.canvas.width+t.x),n=e.data[i],s=e.data[1+i],o=e.data[2+i],i=e.data[3+i],a=this.selectedColorOption.r,r=this.selectedColorOption.g,h=this.selectedColorOption.b,c=Math.round(255*this.selectedAlphaOption);n===a&&s===r&&o===h&&i===c||this.matchOutlineColor(n,s,o,i)||(this.floodFill(t.x,t.y,[this.selectedColorOption.r,this.selectedColorOption.g,this.selectedColorOption.b,Math.round(255*this.selectedAlphaOption)],!1,e,0,!0),this.context.putImageData(e,0,0),this.storeCanvas(),this.storeHistory())},floodFill:function(t,e,o,i,n,a,s){function r(t,e){var i,n,s;return!(t<0||e<0||m<=e||g<=t)&&(i=e*y+4*t,(n=Math.max(Math.abs(x-d[i]),Math.abs(w-d[1+i]),Math.abs(C-d[2+i]),Math.abs(b-d[3+i])))<a&&(n=0),s=Math.abs(0-f[e*g+t]),L||0!==n&&255!==s&&(d[i]=o[0],d[1+i]=o[1],d[2+i]=o[2],d[3+i]=(o[3]+d[3+i])/2,f[e*g+t]=255),n+s===0)}var h,c,l,d=n.data,u=[],p=!1,v=!1,g=n.width,m=n.height,f=new Uint8ClampedArray(g*m),y=4*g,n=(D=e)*y+4*t,x=d[n],w=d[1+n],C=d[2+n],b=d[3+n],L=!1;for(u.push([t,D]);u.length;){for(var P=u.pop(),T=P[0],D=P[1],L=!0;r(T,D-1);)--D;for(L=!1,i&&(!r(T-1,D)&&r(T-1,D-1)&&u.push([T-1,D-1]),!r(T+1,D))&&r(T+1,D-1)&&u.push([T+1,D-1]),v=p=!1;r(T,D);)d[l=(c=D)*y+4*(h=T)]=o[0],d[1+l]=o[1],d[2+l]=o[2],d[3+l]=o[3],f[c*g+h]=255,r(T-1,D)?p||(u.push([T-1,D]),p=!0):p=p&&!1,r(T+1,D)?v||(u.push([T+1,D]),v=!0):v=v&&!1,D+=1;i&&(r(T-1,D)&&!p&&u.push([T-1,D]),r(T+1,D))&&!v&&u.push([T+1,D])}},handleKeyDown:function(t){this.paragraph&&(8!==t.keyCode&&13!==t.keyCode||t.preventDefault(),8===t.keyCode?this.paragraph.backspace():13===t.keyCode&&this.paragraph.newline()),27===t.keyCode?this.exit():46===t.keyCode&&this.eraseAll()},handleKeyPress:function(t){var e;!this.paragraph||1!==t.key.length||t.ctrlKey||t.metaKey||(t.preventDefault(),e=this.drawOptions[this.selectedDrawOption],this.context.font=e.minSize+(e.maxSize-e.minSize)*this.context.lineWidth/20+"px "+e.font,this.paragraph.insert(t.key))},handleMouseDown:function(t){t.preventDefault(),this.mousedown=!0;var e=this.drawOptions[this.selectedDrawOption];if(this.lastMouseDownLoc=this.windowToCanvas((void 0===t.clientX?t.touches[0]:t).clientX,(void 0===t.clientY?t.touches[0]:t).clientY),"pen"===e.type)this.context.beginPath(),this.context.moveTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y+16);else if("eyedropper"===e.type)this.getColorOfCurrentPixel({x:Math.round(l.devicePixelRatio*(void 0===t.clientX?t.touches[0].clientX:t.clientX-2)),y:Math.round(l.devicePixelRatio*(void 0===t.clientY?t.touches[0].clientY:t.clientY+22))});else if("line"===e.type)this.storeCanvas();else if("quadratic_curve"===e.type){if(0===e.iteration)this.storeCanvas(),e.initLoc={x:this.lastMouseDownLoc.x,y:this.lastMouseDownLoc.y};else if(1!==e.iteration)throw new Error("invalid iteration")}else if("bezier_curve"===e.type){if(0===e.iteration)this.storeCanvas(),e.initLoc={x:this.lastMouseDownLoc.x,y:this.lastMouseDownLoc.y};else if(1!==e.iteration&&2!==e.iteration)throw new Error("invalid iteration")}else"polygon"===e.type?(this.storeCanvas(),e.lastLoc?(this.context.beginPath(),this.context.moveTo(e.lastLoc.x,e.lastLoc.y),this.context.lineTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.stroke()):(e.lastLoc={x:this.lastMouseDownLoc.x,y:this.lastMouseDownLoc.y},e.initLoc={x:this.lastMouseDownLoc.x,y:this.lastMouseDownLoc.y})):"circle"===e.type||"rectangle"===e.type?this.storeCanvas():"eraser"===e.type?(this.restoreCanvas(),this.context.save(),this.context.translate(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.clearRect(0,0,e.width,e.height),this.context.restore()):"fill"===e.type?this.handleFill(this.lastMouseDownLoc):"text"===e.type&&(this.cursor.erase(this.context,this.drawingSurfaceImageData),this.storeCanvas(),this.paragraph&&this.paragraph.isPointInside(this.lastMouseDownLoc)?this.paragraph.moveCursorCloseTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y):(this.paragraph&&(this.paragraph.clearIntervals(),this.paragraph=null),t=this.context.measureText("W").width,t+=t/6,this.paragraph=new Paragraph(this.context,this.lastMouseDownLoc.x,this.lastMouseDownLoc.y-t,this.drawingSurfaceImageData,this.cursor),this.paragraph.addLine(new TextLine(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y))))},handleMouseMove:function(t){t.preventDefault();var e=this.drawOptions[this.selectedDrawOption],t=this.windowToCanvas((void 0===t.clientX?t.touches[0]:t).clientX,(void 0===t.clientY?t.touches[0]:t).clientY);this.setLineProperty(),this.mousedown||"eraser"!==e.type||(this.restoreCanvas(),this.context.save(),this.context.translate(t.x,t.y),this.context.clearRect(0,0,e.width,e.height),this.context.restore()),"quadratic_curve"===e.type?1===e.iteration&&e.lastLoc&&(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(e.initLoc.x,e.initLoc.y),this.context.quadraticCurveTo(t.x,t.y,e.lastLoc.x,e.lastLoc.y),this.context.stroke()):"bezier_curve"===e.type&&(1===e.iteration&&e.firstPoint?(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(e.initLoc.x,e.initLoc.y),this.context.quadraticCurveTo(t.x,t.y,e.firstPoint.x,e.firstPoint.y),this.context.stroke()):2===e.iteration&&e.firstPoint&&e.lastPoint&&(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(e.initLoc.x,e.initLoc.y),this.context.bezierCurveTo(e.lastPoint.x,e.lastPoint.y,t.x,t.y,e.firstPoint.x,e.firstPoint.y),this.context.stroke())),this.mousedown&&("pen"===e.type?(this.restoreCanvas(),this.context.lineTo(t.x,t.y+16),this.context.stroke()):"line"===e.type||"quadratic_curve"===e.type&&0===e.iteration||"bezier_curve"===e.type&&0===e.iteration?(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.lineTo(t.x,t.y),this.context.stroke()):"polygon"===e.type?(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(e.lastLoc.x,e.lastLoc.y),this.context.lineTo(t.x,t.y),this.context.stroke()):"circle"===e.type?(this.restoreCanvas(),this.drawEllipse(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y,t.x-this.lastMouseDownLoc.x,t.y-this.lastMouseDownLoc.y)):"rectangle"===e.type?(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.lineTo(this.lastMouseDownLoc.x,t.y),this.context.lineTo(t.x,t.y),this.context.lineTo(t.x,this.lastMouseDownLoc.y),this.context.lineTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.stroke()):"eraser"===e.type&&(this.context.save(),this.context.translate(t.x,t.y),this.context.clearRect(0,0,e.width,e.height),this.context.restore()))},handleMouseUp:function(t){t.preventDefault(),this.mousedown=!1;var e=this.drawOptions[this.selectedDrawOption],t=this.windowToCanvas((void 0===t.clientX?t.changedTouches[0]:t).clientX,(void 0===t.clientY?t.changedTouches[0]:t).clientY);"pen"===e.type||"line"===e.type?(this.context.closePath(),this.storeCanvas(),this.storeHistory()):"quadratic_curve"===e.type?0===e.iteration?(e.lastLoc={x:t.x,y:t.y},e.iteration++):1===e.iteration&&(this.context.closePath(),this.storeCanvas(),this.storeHistory(),e.iteration=0,e.initLoc=null,e.lastLoc=null):"bezier_curve"===e.type?0===e.iteration?(e.firstPoint={x:t.x,y:t.y},e.iteration++):1===e.iteration?(e.lastPoint={x:t.x,y:t.y},e.iteration++):2===e.iteration&&(this.context.closePath(),this.storeCanvas(),this.storeHistory(),e.iteration=0,e.initLoc=null,e.firstPoint=null,e.lastPoint=null):"polygon"===e.type?(this.storeCanvas(),this.storeHistory(),e.lastLoc={x:t.x,y:t.y}):"circle"===e.type?(this.storeCanvas(),this.storeHistory()):"rectangle"===e.type?(this.context.closePath(),this.storeCanvas(),this.storeHistory()):"eraser"===e.type&&(this.storeCanvas(),this.storeHistory())},handleMouseLeave:function(){"eraser"===this.drawOptions[this.selectedDrawOption].type&&this.restoreCanvas()},setLineProperty:function(){this.context.lineJoin="round",this.context.lineCap="round"},drawEllipse:function(t,e,i,n){var s=i/2*.5522848,o=n/2*.5522848,a=t+i,r=e+n,i=t+i/2,n=e+n/2;this.context.beginPath(),this.context.moveTo(t,n),this.context.bezierCurveTo(t,n-o,i-s,e,i,e),this.context.bezierCurveTo(i+s,e,a,n-o,a,n),this.context.bezierCurveTo(a,n+o,i+s,r,i,r),this.context.bezierCurveTo(i-s,r,t,n+o,t,n),this.context.stroke()},addClass:function(t,e){0<=t.className.indexOf(e)||(t.className=t.className+" "+e)},removeClass:function(t,e){t.className=t.className.replace(new RegExp("\\b"+e+"\\b","g"),"")},triggerClick:function(t){this.triggerEvent(t,"click")},triggerEvent:function(t,e){var i;document.createEvent?(i=document.createEvent("HTMLEvents")).initEvent(e,!0,!0):document.createEventObject&&((i=document.createEventObject()).eventType=e),i.eventName=e,t.dispatchEvent?t.dispatchEvent(i):t.fireEvent&&htmlEvents["on"+e]?t.fireEvent("on"+i.eventType,i):t[e]?t[e]():t["on"+e]&&t["on"+e]()},initDragging:function(){this.panel.addEventListener("mousedown",this.handleDraggingStart),this.panel.addEventListener("touchstart",this.handleDraggingStart),l.document.addEventListener("mouseup",this.handleDragDone),l.document.addEventListener("touchend",this.handleDragDone)},handleDraggingStart:function(t){e.pos_x=this.getBoundingClientRect().left-(void 0===t.clientX?t.touches[0]:t).clientX,e.pos_y=this.getBoundingClientRect().top-(void 0===t.clientY?t.touches[0]:t).clientY,this.addEventListener("mousemove",e.handleDragging),this.addEventListener("touchmove",e.handleDragging)},handleDragging:function(t){"INPUT"!==t.target.nodeName.toUpperCase()&&(t.preventDefault(),this.style.top=(void 0===t.clientY?t.touches[0]:t).clientY+e.pos_y+"px",this.style.left=(void 0===t.clientX?t.touches[0]:t).clientX+e.pos_x+"px")},handleDragDone:function(t){e.panel.removeEventListener("mousemove",e.handleDragging),e.panel.removeEventListener("touchmove",e.handleDragging)},windowToCanvas:function(t,e){var i=this.canvas.getBoundingClientRect();return{x:Math.round(t)-i.left*(this.canvas.width/i.width),y:Math.round(e)-i.top*(this.canvas.height/i.height)}},handlePostMessageResponse:function(t){t.origin===l.location.origin&&("get_pixel_color_response"===(t=t.data).method?this.setColor(t.response):"get_data_response"===t.method&&this.render(t.response))},exit:function(){this.canvas.parentNode.removeChild(this.canvas),this.panel.parentNode.removeChild(this.panel),l.document.removeEventListener("keydown",this.keydownBinded),l.document.removeEventListener("keypress",this.keypressBinded),l.document.removeEventListener("keydown",this.handleHotKeysDownBinded),l.document.removeEventListener("mouseup",this.handleDragDone),l.removeEventListener("resize",this.resizeBinded),l.removeEventListener("scroll",this.resizeBinded),this.canvas=null,this.context=null,this.selectedDrawOption=null,this.selectedColorOption=null,this.selectedAlphaOption=null,this.mousedown=!1,this.lastMouseDownLoc=null,this.drawingSurfaceImageData=null,this.paragraph=null,this.panel=null,this.initialized=!1,this.controlPanelHidden=!1,"undefined"!=typeof unsafeWindow&&null!==unsafeWindow&&(unsafeWindow.CTRL_HIDDEN=unsafeWindow.NOTEPAD_INIT=!1)},eraseAll:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.paragraph&&(this.paragraph.clearIntervals(),this.paragraph=null),this.storeCanvas(!0),this.storeHistory(),l.localStorage.removeItem("WP_CRX_STORAGE_SNAPSHOT_"+l.location.pathname)},hideControlPanel:function(){this.addClass(this.panel,"hide"),this.controlPanelHidden=!0,"undefined"!=typeof unsafeWindow&&null!==unsafeWindow&&(unsafeWindow.CTRL_HIDDEN=!0)},showControlPanel:function(){this.removeClass(this.panel,"hide"),this.controlPanelHidden=!1,"undefined"!=typeof unsafeWindow&&null!==unsafeWindow&&(unsafeWindow.CTRL_HIDDEN=!1)},saveData:function(){chrome.runtime.sendMessage({method:"save_data",config:this.config})},render:function(t){this.config=t||{},this.createCanvas(),this.setLineProperty(),this.createControlPanel(),this.initDragging(),this.addMouseEventListener(),this.addKeyEventListeners(),this.incrementCounter()},initConfig:function(){chrome.runtime.sendMessage({method:"get_data"},t=>{this.render(t)})},incrementCounter:function(){document.querySelector(".NOTEPAD_controls_draw").addEventListener("click",t=>{t.preventDefault(),chrome.storage.local.get(["openTimes3","rateClicked3"],function(t){let{openTimes3:e,rateClicked3:i}=t;if(e?e+=1:e=1,chrome.storage.local.set({openTimes3:e}),!i&&e%7==0&&!document.getElementById("xxdialog-rate")){document.querySelector("body").insertAdjacentHTML("beforeend",a);for(var n=document.querySelectorAll("[i18n]"),s=0;s<n.length;++s)n[s].textContent=chrome.i18n.getMessage(n[s].getAttribute("i18n"));for(n=document.querySelectorAll("[i18n-alt]"),s=0;s<n.length;++s){var o=chrome.i18n.getMessage(n[s].getAttribute("i18n-alt"));n[s].alt=o,n[s].title=o}document.querySelector("#xxdialog-yes").addEventListener("click",function(){chrome.storage.local.set({rateClicked3:!0}),document.getElementById("xxdialog-rate").remove(),window.open("https://chrome.google.com/webstore/detail/"+chrome.runtime.id+"/reviews","_blank").focus()}),document.querySelector("#xxdialog-no").addEventListener("click",function(){document.getElementById("xxdialog-rate").remove()})}})});const a=""},init:function(){this.history=new t,this.CSSAnimationManager=function(){for(var t,e,i,n=!1,s=["webkit","Moz","O",""],o=s.length,a=document.documentElement.style;o--;)if(s[o]){if(void 0!==a[s[o]+"AnimationName"]){switch(t=s[o],o){case 0:e=t.toLowerCase()+"AnimationStart",i=t.toLowerCase()+"AnimationEnd",n=!0;break;case 1:e="animationstart",i="animationend",n=!0;break;case 2:e=t.toLowerCase()+"animationstart",i=t.toLowerCase()+"animationend",n=!0}break}}else if(void 0!==a.animationName){t=s[o],e="animationstart",i="animationend",n=!0;break}return{supported:n,prefix:t,start:e,end:i}}(),this.setColorBinded=Function.prototype.bind.call(this.setColor,this),this.renderBinded=Function.prototype.bind.call(this.render,this),this.handlePostMessageResponseBinded=Function.prototype.bind.call(this.handlePostMessageResponse,this),this.keydownBinded=Function.prototype.bind.call(this.handleKeyDown,this),this.keypressBinded=Function.prototype.bind.call(this.handleKeyPress,this),this.handleHotKeysDownBinded=Function.prototype.bind.call(this.handleHotKeysDown,this),this.persistLocalStorageBinded=Function.prototype.bind.call(this.persistLocalStorage,this),this.resizeBinded=Function.prototype.bind.call(function(){this.resizeTimeoutID&&(this.resizeTimeoutID=l.clearTimeout(this.resizeTimeoutID)),this.resizeTimeoutID=l.setTimeout(Function.prototype.bind.call(this.handleResize,this),200)},this),this.initConfig(),this.initialized=!0,"undefined"!=typeof unsafeWindow&&null!==unsafeWindow&&(unsafeWindow.NOTEPAD_INIT=!0)}};return e},"undefined"!=typeof unsafeWindow&&null!==unsafeWindow?unsafeWindow.CTRL_HIDDEN?t.NOTEPAD.showControlPanel():unsafeWindow.NOTEPAD_INIT||(t.NOTEPAD=e(t),t.NOTEPAD.init()):(void 0!==t.NOTEPAD&&null!==t.NOTEPAD||(t.NOTEPAD=e(t)),t.NOTEPAD.controlPanelHidden?t.NOTEPAD.showControlPanel():t.NOTEPAD.initialized||t.NOTEPAD.init())}})[710]();